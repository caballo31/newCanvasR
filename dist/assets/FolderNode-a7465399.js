import{c as I,j as t,a as P,T as R,r as d,R as S,b as M,d as z}from"./index-4d198d9d.js";const F=I("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),L=({selectedIds:i,contextLabel:u,onDelete:f,onDuplicate:h,onOpen:g,visible:x})=>{if(!x)return null;const p=i.length===0;return t.jsx("div",{style:{position:"sticky",top:0,zIndex:1e3},className:"bg-white border-b border-gray-200",children:t.jsxs("div",{className:"w-full p-2 flex items-center justify-between",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700",children:u}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("button",{onClick:()=>g(i[0]),disabled:p,title:"Abrir",className:"p-2 rounded hover:bg-gray-100 disabled:opacity-40",children:t.jsx(F,{size:16})}),t.jsx("button",{onClick:()=>h(i),disabled:p,title:"Duplicar",className:"p-2 rounded hover:bg-gray-100 disabled:opacity-40",children:t.jsx(P,{size:16})}),t.jsx("button",{onClick:()=>f(i),disabled:p,title:"Eliminar",className:"p-2 rounded hover:bg-red-100 disabled:opacity-40",children:t.jsx(R,{size:16})})]})]})})},B=({node:i,onUpdate:u,allNodes:f,onAddToFolder:h})=>{var b,j;const g=d.useMemo(()=>{const e={};return(f||[]).forEach(s=>{e[s.id]=s}),e},[f]),x=d.useMemo(()=>!i.children||i.children.length===0?[]:i.children.map(e=>g[e]).filter(Boolean),[i.children,g]),p=i.view==="window"||i.view==="fullscreen",[o,v]=d.useState([]),[D,w]=d.useState(!0),m=d.useRef(null),k=180,E=5,c=d.useRef(null),[C,y]=d.useState([]);return S.useEffect(()=>()=>{const e=c.current;if(e&&e.timer){try{window.clearTimeout(e.timer)}catch{}c.current=null}},[]),p?t.jsx("div",{"data-node-id":i.id,style:{width:"100%",height:"100%",position:"relative",userSelect:"none",overflow:"hidden"},onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const s=e.dataTransfer.getData("text/node-id");s&&h&&h(s,i.id)},children:t.jsxs("div",{className:"w-full h-full",style:{padding:8},children:[t.jsx("div",{ref:m,tabIndex:0,className:"w-full h-full overflow-auto",style:{padding:0},onClick:()=>{var e;v([]);try{(e=m.current)==null||e.focus()}catch{}},onKeyDown:e=>{var s;if((e.key==="Delete"||e.key==="Backspace")&&o.length>0){const l=new CustomEvent("risspo-folder-action",{detail:{action:"delete",ids:o}});(s=m.current)==null||s.dispatchEvent(l),e.preventDefault()}},onFocus:()=>{w(!0)},onBlur:()=>{w(!1)},children:t.jsx("div",{className:"grid grid-cols-3 gap-2",style:{alignItems:"start",gridAutoRows:"min-content"},children:x.map(e=>{const s=r=>{r.stopPropagation();const n=r.currentTarget;c.current={id:e.id,downX:r.clientX,downY:r.clientY,timer:window.setTimeout(()=>{const a=c.current;a&&(a.dragging=!0)},k),moved:!1,dragging:!1};try{n.setPointerCapture(r.pointerId)}catch{}v([e.id])},l=r=>{const n=c.current;if(!n||n.id!==e.id)return;const a=r.clientX-n.downX,T=r.clientY-n.downY;if(!n.moved&&Math.hypot(a,T)>=E){if(n.moved=!0,n.dragging=!0,n.timer){try{window.clearTimeout(n.timer)}catch{}n.timer=null}o.length>1&&o.includes(e.id)?y(o):y([e.id])}},N=r=>{r.stopPropagation();const n=r.currentTarget,a=c.current;if(a&&a.timer)try{window.clearTimeout(a.timer)}catch{}try{n.releasePointerCapture(r.pointerId)}catch{}!a||!a.dragging&&a.moved,c.current=null,y([])};return t.jsxs("div",{"data-child-id":e.id,className:`relative bg-gray-50 rounded text-center text-sm shadow-sm ${o.includes(e.id)?"ring-2 ring-orange-300":""}`,style:{padding:0,display:"flex",justifyContent:"center"},draggable:!0,onDragStart:r=>{r.dataTransfer.setData("text/node-id",e.id);try{r.dataTransfer.effectAllowed="move"}catch{}const n=c.current;if(n&&n.timer)try{window.clearTimeout(n.timer)}catch{}},onPointerDown:s,onPointerMove:l,onPointerUp:N,onDoubleClick:r=>{r.stopPropagation(),u&&u(e.id,{view:"fullscreen"}),v([e.id])},children:[t.jsx("div",{style:{pointerEvents:"none",padding:8},children:t.jsx(z,{type:e.type,title:e.title,label:e.content})}),C.includes(e.id)&&t.jsx("div",{style:{position:"absolute",left:0,top:0,right:0,bottom:0,border:"1px dashed rgba(59,130,246,0.8)",background:"rgba(59,130,246,0.08)",borderRadius:6,pointerEvents:"none"}})]},e.id)})})}),t.jsx(L,{selectedIds:o,contextLabel:o.length===1?((b=g[o[0]])==null?void 0:b.title)||((j=g[o[0]])==null?void 0:j.content)||"":o.length>1?`${o.length} seleccionados`:"",onDelete:e=>{var l;const s=new CustomEvent("risspo-folder-action",{detail:{action:"delete",ids:e}});(l=m.current)==null||l.dispatchEvent(s)},onDuplicate:e=>{var l;const s=new CustomEvent("risspo-folder-action",{detail:{action:"duplicate",ids:e}});(l=m.current)==null||l.dispatchEvent(s)},onOpen:e=>{e&&u&&u(e,{view:"window"})},visible:o.length>0&&D})]})}):t.jsx("div",{"data-node-id":i.id,style:{width:"100%",height:"100%",position:"relative",userSelect:"none"},children:t.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 bg-gray-50 rounded-lg",children:t.jsxs("div",{className:"text-center",children:[t.jsx(M,{size:28,className:"text-gray-500 mb-2 mx-auto"}),t.jsx("div",{className:"text-sm text-gray-700",children:i.content})]})})})};export{B as default};
