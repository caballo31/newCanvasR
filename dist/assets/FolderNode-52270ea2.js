import{r as a,j as r,a as b,b as P}from"./index-1c1922d6.js";const C=({node:n,onUpdate:l,allNodes:c,onAddToFolder:u,onSelect:f,onClearSelection:p,selectedIds:o,onToggleSelectFromFolder:g})=>{const m=a.useMemo(()=>{const t={};return(c||[]).forEach(e=>{t[e.id]=e}),t},[c]),v=a.useMemo(()=>!n.children||n.children.length===0?[]:n.children.map(t=>m[t]).filter(Boolean),[n.children,m]),w=n.view==="window"||n.view==="fullscreen",[y,s]=a.useState(null),j=o||[],x=a.useRef(null);return a.useEffect(()=>{const t=e=>{const i=x.current;if(!i)return;const D=e.composedPath&&typeof e.composedPath=="function"?e.composedPath():[e.target];for(const d of D)try{if(d===i||d instanceof Node&&i.contains(d))return}catch{}const h=e.target;h&&i&&!i.contains(h)&&s(null)};return window.addEventListener("pointerdown",t,!0),()=>window.removeEventListener("pointerdown",t,!0)},[]),w?r.jsx("div",{"data-node-id":n.id,style:{width:"100%",height:"100%",position:"relative",userSelect:"none",overflow:"hidden"},onDragOver:t=>t.preventDefault(),onDrop:t=>{t.preventDefault();const e=t.dataTransfer.getData("text/node-id");e&&u&&u(e,n.id)},children:r.jsx("div",{ref:x,className:"w-full h-full overflow-auto grid grid-cols-3 gap-2",style:{padding:12,boxSizing:"border-box",alignItems:"start",gridAutoRows:"min-content"},onPointerDown:t=>{t.stopPropagation()},onMouseDown:t=>{t.stopPropagation()},onClick:()=>{s(null),p&&p()},children:v.map(t=>r.jsx("div",{"data-child-id":t.id,className:`relative bg-gray-50 rounded text-center text-sm shadow-sm ${y===t.id||j.includes(t.id)?"ring-2 ring-orange-300":""}`,style:{padding:0,display:"flex",justifyContent:"center",cursor:"pointer"},draggable:!0,onDragStart:e=>{try{const i=o&&o.length>0&&o.includes(t.id)?o:[t.id];e.dataTransfer.setData("text/node-ids",JSON.stringify(i)),e.dataTransfer.setData("text/node-id",t.id),e.dataTransfer.effectAllowed="move"}catch{}},onClick:e=>{if(e.stopPropagation(),s(t.id),g){const i=e.altKey||e.shiftKey;g(t.id,n.id,i)}else try{f&&f(t.id)}catch{}},onDoubleClick:e=>{e.stopPropagation(),l&&l(t.id,{view:"fullscreen"})},children:r.jsx("div",{style:{pointerEvents:"none",padding:8},children:r.jsx(P,{type:t.type,title:t.title,label:t.content})})},t.id))})}):r.jsx("div",{"data-node-id":n.id,style:{width:"100%",height:"100%",position:"relative",userSelect:"none"},children:r.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 bg-gray-50 rounded-lg",children:r.jsxs("div",{className:"text-center",children:[r.jsx(b,{size:28,className:"text-gray-500 mb-2 mx-auto"}),r.jsx("div",{className:"text-sm text-gray-700",children:n.content})]})})})};export{C as default};
